"use strict";(self["webpackChunkairstay"]=self["webpackChunkairstay"]||[]).push([[108],{1362:function(t,e,a){a.d(e,{A:function(){return $}});var l=a(6768),n=a(4232);const d={class:"modal fade",id:"delModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},s={class:"modal-dialog",role:"document"},o={class:"modal-content border-0"},i={class:"modal-header bg-danger text-white"},r={class:"modal-title"},u={key:0},c={key:1},p={class:"modal-body"},h={key:0,class:"text-danger"},k={key:1,class:"text-danger"},m={class:"modal-footer"},L=(0,l.Lk)("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function g(t,e,a,g,b,f){return(0,l.uX)(),(0,l.CE)("div",d,[(0,l.Lk)("div",s,[(0,l.Lk)("div",o,[(0,l.Lk)("div",i,[(0,l.Lk)("h5",r,[1===a.infoLength?((0,l.uX)(),(0,l.CE)("span",u,"刪除 "+(0,n.v_)(a.item.title),1)):((0,l.uX)(),(0,l.CE)("span",c,"刪除多筆資料"))])]),(0,l.Lk)("div",p,[(0,l.eW)(" 是否刪除 "),1===a.infoLength?((0,l.uX)(),(0,l.CE)("strong",h,(0,n.v_)(a.item.title),1)):((0,l.uX)(),(0,l.CE)("strong",k,"多筆資料")),(0,l.eW)(" (刪除後將無法恢復)。 ")]),(0,l.Lk)("div",m,[L,(0,l.Lk)("button",{type:"button",class:"btn btn-danger",onClick:e[0]||(e[0]=e=>t.$emit("del-item"))}," 確認刪除 ")])])])],512)}var b=a(2894),f=a.n(b),v={data(){return{modal:{},isMany:!1}},mounted(){this.modal=new(f())(this.$refs.modal)},props:{item:{type:Object,default(){return{}}},infoLength:{}},watch:{},methods:{showModal(){this.modal.show()},hideModal(){this.modal.hide()}}},y=a(1241);const C=(0,y.A)(v,[["render",g]]);var $=C},2063:function(t,e,a){a.d(e,{A:function(){return g}});var l=a(6768),n=a(4232),d=a(5130);const s={"aria-label":"Page navigation example"},o={class:"pagination justify-content-center"},i=(0,l.Lk)("span",{"aria-hidden":"true"},"«",-1),r=[i],u=["onClick"],c=(0,l.Lk)("span",{"aria-hidden":"true"},"»",-1),p=[c];function h(t,e,a,i,c,h){return(0,l.uX)(),(0,l.CE)("nav",s,[(0,l.Lk)("ul",o,[(0,l.Lk)("li",{class:(0,n.C4)(["page-item mx-1",{disabled:!a.pages.has_pre}])},[(0,l.Lk)("a",{class:"page-link rounded-pill text-black-50",href:"#","aria-label":"Previous",onClick:e[0]||(e[0]=(0,d.D$)((t=>h.updatePage(a.pages.current_page-1)),["prevent"]))},r)],2),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(a.pages.total_pages,(t=>((0,l.uX)(),(0,l.CE)("li",{class:(0,n.C4)(["page-item mx-1",{active:t===a.pages.current_page}]),key:t},[(0,l.Lk)("a",{class:"page-link rounded-pill text-black-50",href:"#",onClick:(0,d.D$)((e=>h.updatePage(t)),["prevent"])},(0,n.v_)(t),9,u)],2)))),128)),(0,l.Lk)("li",{class:(0,n.C4)(["page-item mx-1",{disabled:!a.pages.has_next}])},[(0,l.Lk)("a",{class:"page-link rounded-pill text-black-50",href:"#","aria-label":"Next",onClick:e[1]||(e[1]=(0,d.D$)((t=>h.updatePage(a.pages.current_page+1)),["prevent"]))},p)],2)])])}var k={props:["pages"],methods:{updatePage(t){this.$emit("update-page",t)}}},m=a(1241);const L=(0,m.A)(k,[["render",h]]);var g=L},108:function(t,e,a){a.r(e),a.d(e,{default:function(){return rt}});var l=a(6768),n=a(4232),d=a(5130),s=a(2009);const o=(0,l.Lk)("img",{src:s,alt:"Loading...",style:{width:"100px"}},null,-1),i=(0,l.Lk)("h3",null,"訂單列表",-1),r={class:"table mt-4"},u=(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[(0,l.Lk)("th",{width:"80"},"訂單成立時間"),(0,l.Lk)("th",{width:"120"},"帳號(Email)"),(0,l.Lk)("th",{width:"400"},"預定飯店名稱"),(0,l.Lk)("th",{width:"80"},"應付金額"),(0,l.Lk)("th",{width:"80"},"是否已付款"),(0,l.Lk)("th",{width:"80"},"設定")])],-1),c={class:"list-unstyled"},p={key:0,class:"text-success"},h={key:1},k={class:"btn-group"},m=["onClick"],L=["onClick"];function g(t,e,a,s,g,b){const f=(0,l.g2)("Loading"),v=(0,l.g2)("Pagination"),y=(0,l.g2)("OrderModal"),C=(0,l.g2)("DelModal");return(0,l.uX)(),(0,l.CE)(l.FK,null,[(0,l.bF)(f,{active:t.isLoading},{default:(0,l.k6)((()=>[o])),_:1},8,["active"]),(0,l.bo)((0,l.Lk)("div",null,[i,(0,l.Lk)("table",r,[u,(0,l.Lk)("tbody",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(g.orderInfo,((e,a)=>((0,l.uX)(),(0,l.CE)("tr",{key:a},[(0,l.Lk)("td",null,(0,n.v_)(t.$numFilter.date(e.create_at)),1),(0,l.Lk)("td",null,(0,n.v_)(e.user.email),1),(0,l.Lk)("td",null,[(0,l.Lk)("ul",c,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(e.products,((t,e)=>((0,l.uX)(),(0,l.CE)("li",{key:e},(0,n.v_)(t.product.title)+"："+(0,n.v_)(t.qty)+"間房間 ",1)))),128))])]),(0,l.Lk)("td",null,"$"+(0,n.v_)(t.$numFilter.currency(e.total)),1),(0,l.Lk)("td",null,[e.is_paid?((0,l.uX)(),(0,l.CE)("strong",p,"已付款")):((0,l.uX)(),(0,l.CE)("span",h,"未付款"))]),(0,l.Lk)("td",null,[(0,l.Lk)("div",k,[(0,l.Lk)("button",{class:"btn btn-outline-primary btn-sm",onClick:t=>b.openEditModal(e)},"檢視 ",8,m),(0,l.Lk)("button",{class:"btn btn-outline-danger btn-sm",onClick:t=>b.openDeleteModal(e.products,e.id)},"刪除 ",8,L)])])])))),128))])])],512),[[d.aG,g.isLogin]]),(0,l.bF)(v,{pages:g.pagination,onUpdatePage:b.updatePage},null,8,["pages","onUpdatePage"]),(0,l.bF)(y,{ref:"orderModal",item:g.tempOrderInfo,onUpdatePaid:b.updatePaid},null,8,["item","onUpdatePaid"]),(0,l.bF)(C,{ref:"delModal",item:g.tempOrderInfo,infoLength:g.infoLength,onDelItem:b.deleteItem},null,8,["item","infoLength","onDelItem"])],64)}a(4114);const b={class:"modal fade",id:"productModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},f={class:"modal-dialog modal-xl",role:"document"},v={class:"modal-content border-0"},y=(0,l.Lk)("div",{class:"modal-header bg-dark text-white"},[(0,l.Lk)("h5",{class:"modal-title",id:"exampleModalLabel"},[(0,l.Lk)("span",null,"訂單細節")])],-1),C={class:"modal-body"},$={class:"row"},_={class:"col-md-4"},x=(0,l.Lk)("h3",null,"訂購人資訊",-1),O={class:"table"},E={key:0},M=(0,l.Lk)("th",{style:{width:"100px"}},"姓名",-1),w=(0,l.Lk)("th",null,"Email",-1),I=(0,l.Lk)("th",null,"電話",-1),X=(0,l.Lk)("th",null,"地址",-1),F={class:"col-md-8"},P=(0,l.Lk)("h3",null,"訂單細節",-1),A={class:"table"},D=(0,l.Lk)("th",{style:{width:"100px"}},"訂單編號",-1),K=(0,l.Lk)("th",null,"下單時間",-1),U=(0,l.Lk)("th",null,"付款時間",-1),j={key:0},q={key:1},W=(0,l.Lk)("th",null,"付款狀態",-1),z={class:"form-check form-switch"},G=["id"],H=["for"],N={key:0,class:"text-success"},Q={key:1,class:"text-muted"},T=(0,l.Lk)("th",null,"總金額",-1),V=(0,l.Lk)("h3",null,"訂購飯店",-1),B={class:"table"},J=(0,l.Lk)("thead",null,[(0,l.Lk)("tr")],-1),R={class:""},S={class:""},Y={class:"modal-footer"};function Z(t,e,a,s,o,i){return(0,l.uX)(),(0,l.CE)("div",b,[(0,l.Lk)("div",f,[(0,l.Lk)("div",v,[y,(0,l.Lk)("div",C,[(0,l.Lk)("div",$,[(0,l.Lk)("div",_,[x,(0,l.Lk)("table",O,[o.tempOrder.user?((0,l.uX)(),(0,l.CE)("tbody",E,[(0,l.Lk)("tr",null,[M,(0,l.Lk)("td",null,(0,n.v_)(o.tempOrder.user.name),1)]),(0,l.Lk)("tr",null,[w,(0,l.Lk)("td",null,(0,n.v_)(o.tempOrder.user.email),1)]),(0,l.Lk)("tr",null,[I,(0,l.Lk)("td",null,(0,n.v_)(o.tempOrder.user.tel),1)]),(0,l.Lk)("tr",null,[X,(0,l.Lk)("td",null,(0,n.v_)(o.tempOrder.user.address),1)])])):(0,l.Q3)("",!0)])]),(0,l.Lk)("div",F,[P,(0,l.Lk)("table",A,[(0,l.Lk)("tbody",null,[(0,l.Lk)("tr",null,[D,(0,l.Lk)("td",null,(0,n.v_)(o.tempOrder.id),1)]),(0,l.Lk)("tr",null,[K,(0,l.Lk)("td",null,(0,n.v_)(t.$numFilter.date(o.tempOrder.create_at)),1)]),(0,l.Lk)("tr",null,[U,(0,l.Lk)("td",null,[o.tempOrder.paid_date?((0,l.uX)(),(0,l.CE)("span",j,(0,n.v_)(t.$numFilter.date(o.tempOrder.paid_date)),1)):((0,l.uX)(),(0,l.CE)("span",q,"時間不正確"))])]),(0,l.Lk)("tr",null,[W,(0,l.Lk)("td",null,[(0,l.Lk)("div",z,[(0,l.bo)((0,l.Lk)("input",{class:"form-check-input",type:"checkbox",id:`switch${a.item.id}`,"onUpdate:modelValue":e[0]||(e[0]=t=>o.tempOrder.is_paid=t)},null,8,G),[[d.lH,o.tempOrder.is_paid]]),(0,l.Lk)("label",{class:"form-check-label",for:`switch${a.item.id}`},[o.tempOrder.is_paid?((0,l.uX)(),(0,l.CE)("strong",N,"已付款")):((0,l.uX)(),(0,l.CE)("span",Q,"尚未付款"))],8,H)])])]),(0,l.Lk)("tr",null,[T,(0,l.Lk)("td",null,"$"+(0,n.v_)(t.$numFilter.currency(o.tempOrder.total)),1)])])]),V,(0,l.Lk)("table",B,[J,(0,l.Lk)("tbody",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(o.tempOrder.products,(e=>((0,l.uX)(),(0,l.CE)("tr",{key:e.id},[(0,l.Lk)("th",null,(0,n.v_)(e.product.title),1),(0,l.Lk)("td",null,"房間數量: "+(0,n.v_)(e.qty)+" 間",1),(0,l.Lk)("td",R," 單價: $"+(0,n.v_)(t.$numFilter.currency(e.product.price)),1),(0,l.Lk)("td",S," 總計: $"+(0,n.v_)(t.$numFilter.currency(e.final_total)),1)])))),128))])])])])]),(0,l.Lk)("div",Y,[(0,l.Lk)("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal",onClick:e[1]||(e[1]=e=>t.$emit("update-paid",o.tempOrder))}," 確認 ")])])])],512)}var tt=a(3286),et={data(){return{tempOrder:{}}},props:{item:{type:Object,default(){return{}}}},watch:{item(){this.tempOrder=this.item}},mixins:[tt.A],methods:{}},at=a(1241);const lt=(0,at.A)(et,[["render",Z]]);var nt=lt,dt=a(1362),st=a(2063),ot={data(){return{isLogin:!1,orderInfo:[],orderComponent:{},delComponent:{},tempOrderInfo:{},infoLength:0,pagination:{}}},components:{OrderModal:nt,DelModal:dt.A,Pagination:st.A},created(){this.isLoading=!0;const t=document.cookie.replace(/(?:(?:^|.*;\s*)hexToken\s*=\s*([^;]*).*$)|^.*$/,"$1");this.$http.defaults.headers.common.Authorization=t;const e="https://vue3-course-api.hexschool.io/api/user/check";this.$http.post(e,this.user).then((t=>{t.data.success?this.isLogin=!0:this.$router.push("/dashboard/login"),this.isLoading=!1})),this.getOrderInfo()},mounted(){this.orderComponent=this.$refs.orderModal,this.delComponent=this.$refs.delModal},methods:{getOrderInfo(t=1){this.isLoading=!0;const e=`https://vue3-course-api.hexschool.io/api/airstay/admin/orders?page=${t}`;this.$http.get(e).then((t=>{t.data.success?(this.orderInfo=t.data.orders,this.pagination=t.data.pagination,console.log("[後台] 取得訂單列表成功",t.data)):console.log("[後台] 取得訂單列表失敗"),this.isLoading=!1}))},openEditModal(t){console.log(t),this.tempOrderInfo={...t},this.orderComponent.showModal()},openDeleteModal(t,e){this.itemId=e;const a=Object.keys(t);this.infoLength=a.length,a.length>1?this.tempOrderInfo={...t}:this.tempOrderInfo={...t[a].product},this.delComponent.showModal()},deleteItem(){this.isLoading=!0;const t=`https://vue3-course-api.hexschool.io/api/airstay/admin/order/${this.itemId}`;this.$http.delete(t).then((t=>{t.data.success?(this.delComponent.hideModal(),this.getOrderInfo(),console.log("[後台] 刪除訂單成功",t.data)):console.log("[後台] 刪除訂單成功失敗"),this.$httpMessage(t,"刪除訂單"),this.isLoading=!1}))},updatePaid(t){this.isLoading=!0;const e=`https://vue3-course-api.hexschool.io/api/airstay/admin/order/${t.id}`;this.$http.put(e,{data:t}).then((t=>{t.data.success?(this.getOrderInfo(),console.log("[後台] 修改訂單成功",t.data)):console.log("[後台] 修改訂單失敗"),this.$httpMessage(t,"修改訂單"),this.isLoading=!1}))},updatePage(t){this.getOrderInfo(t)}}};const it=(0,at.A)(ot,[["render",g]]);var rt=it},2009:function(t,e,a){t.exports=a.p+"img/loadingAni.04376c8d.gif"}}]);
//# sourceMappingURL=108.89b82081.js.map